<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Dashboard</title>

  <!-- ADMIN CSS -->
  <link rel="stylesheet" href="/public/css/admin.css">

  <!-- FONT AWESOME -->
  <link rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>

<body class="admin-body">

<!-- ================= HEADER ================= -->
<header class="dashboard-header">

  <div class="dashboard-title">
    <i class="fa-solid fa-shield-halved" style="color:#7b2cff;"></i>
    Admin Dashboard
    <span>
      Welcome,
      <strong><%= adminUser || 'Admin' %></strong>
    </span>
  </div>

  <div class="dashboard-actions">

    <!-- SEARCH BAR -->
    <form action="/admin/dashboard" method="GET" style="display:inline-flex; align-items:center; background:#fff; padding:5px 10px; border-radius:50px; margin-right:10px; border:1px solid #eee; box-shadow: 0 2px 5px rgba(0,0,0,0.05);">
      <input type="text" name="search" placeholder="Search Name, Phone..." value="<%= locals.searchQuery %>"
             style="border:none; outline:none; font-size:14px; padding:5px; width: 200px;">
      <button type="submit" style="background:none; border:none; color:#7b2cff; cursor:pointer;">
        <i class="fa-solid fa-magnifying-glass"></i>
      </button>
      <% if (locals.searchQuery) { %>
        <a href="/admin/dashboard" style="color:#999; margin-left:5px; text-decoration:none;"><i class="fa-solid fa-times"></i></a>
      <% } %>
    </form>

    <a href="/admin/registrations" class="btn-upload">
      <i class="fa-solid fa-clipboard-list"></i>
      Registrations
    </a>

    <a href="/admin/manage" class="btn-upload">
      <i class="fa-solid fa-users-gear"></i>
      Manage Admins
    </a>

    <a href="/admin/upload" class="btn-upload">
      <i class="fa-solid fa-cloud-arrow-up"></i>
      Upload Certificate
    </a>

    <button onclick="openDownloadModal()" class="btn-upload" style="background-color: #ff9800; cursor: pointer; border: none; font-size: 14px; font-family: inherit;">
      <i class="fa-solid fa-download"></i>
      Download
    </button>

    <a href="/admin/logout" class="btn-logout">
      <i class="fa-solid fa-right-from-bracket"></i>
      Logout
    </a>

  </div>
</header>

<!-- ================= MAIN ================= -->
<div class="dashboard-container">

  <!-- STATS CARD -->
  <div class="table-card">
    <div class="table-header">
      <div class="table-title">Student Records</div>
    </div>

    <div style="padding:18px;font-weight:600;color:#555;">
      Total Records:
      <span style="color:#7b2cff;"><%= total || 0 %></span>
    </div>
  </div>

  <!-- STUDENT TABLE -->
  <div class="table-card">

    <div class="table-header">
      <div class="table-title">Registered Students</div>
    </div>

    <div class="table-responsive">
      <table class="admin-table">

        <thead>
          <tr>
            <th>Name</th>
            <th>Reg No</th>
            <th>Course</th>
            <th>Email</th>
            <th>DOB</th>
            <th>Certificate</th>
            <th>Uploaded</th>
            <th>Fees</th>
            <th>Actions</th>
          </tr>
        </thead>

        <tbody>

        <% if (!students || students.length === 0) { %>
          <tr>
            <td colspan="7" style="text-align:center;padding:30px;color:#777;">
              No records found
            </td>
          </tr>
        <% } else { %>

          <% students.forEach(s => { %>
            <tr>
              <td><%= s.name || '-' %></td>
              <td><%= s.regNumber || '-' %></td>
              <td><span style="font-weight:600; color:#555;"><%= s.course || '-' %></span></td>
              <td><%= s.email || '-' %></td>
              <td><%= s.dob || '-' %></td>

              <td>
                <% if (s.certificatePath) { %>
                  <div style="display:flex; align-items:center; gap:8px;">
                    <a href="<%= s.certificatePath %>"
                       target="_blank"
                       class="view-link">
                      <i class="fa-solid fa-eye"></i> View
                    </a>
                    <form method="POST" action="/admin/delete-certificate" onsubmit="return confirm('Are you sure you want to delete this certificate?');" style="margin:0;">
                      <input type="hidden" name="regNumber" value="<%= s.regNumber %>">
                      <button type="submit" style="background:none; border:none; color:#ff4444; cursor:pointer; font-size:16px;" title="Delete Certificate">
                        <i class="fa-solid fa-trash-can"></i>
                      </button>
                    </form>
                  </div>
                <% } else { %>
                  <span style="color:#aaa;">Pending</span>
                <% } %>
              </td>

              <td><%= s.uploadedAt || '-' %></td>

              <td>
                <a href="/admin/fees/<%= s.regNumber %><%= locals.searchQuery ? '?search=' + locals.searchQuery : '' %>" class="btn-upload" style="background:#00c851; padding:5px 10px; font-size:12px; text-decoration:none;">
                  <i class="fa-solid fa-indian-rupee-sign"></i> Update
                </a>
              </td>

              <td>
                <form method="POST"
                      action="/admin/delete"
                      onsubmit="return confirm('Delete this record?');">
                  <input type="hidden"
                         name="regNumber"
                         value="<%= s.regNumber %>">

                  <button type="submit" class="btn-delete">
                    <i class="fa-solid fa-trash"></i>
                    Delete
                  </button>
                </form>
              </td>
            </tr>
          <% }) %>

        <% } %>

        </tbody>
      </table>
    </div>
  </div>

  <!-- FOOTER -->
  <div class="admin-footer">
    Â© 2025 Ganga Computer Center. All rights reserved.
  </div>

</div>

<!-- DOWNLOAD MODAL -->
<div id="downloadModal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.5); z-index:1000; justify-content:center; align-items:center;">
  <div style="background:white; padding:25px; border-radius:10px; width:300px; text-align:center; box-shadow:0 5px 15px rgba(0,0,0,0.2);">
    <h3 style="margin-top:0; color:#333;">Download Records</h3>
    <p style="color:#666; margin-bottom:20px;">Select format to download student records</p>
    
    <div style="display:flex; flex-direction:column; gap:10px;">
      <a href="/admin/download/excel" onclick="closeDownloadModal()" style="text-decoration:none; background:#217346; color:white; padding:10px; border-radius:5px; display:flex; align-items:center; justify-content:center; gap:10px;">
        <i class="fa-solid fa-file-excel"></i> Download Excel
      </a>
      <a href="/admin/download/pdf" onclick="closeDownloadModal()" style="text-decoration:none; background:#b30b00; color:white; padding:10px; border-radius:5px; display:flex; align-items:center; justify-content:center; gap:10px;">
        <i class="fa-solid fa-file-pdf"></i> Download PDF
      </a>
    </div>

    <button onclick="closeDownloadModal()" style="margin-top:20px; background:none; border:none; color:#777; cursor:pointer; text-decoration:underline;">Cancel</button>
  </div>
</div>

<script>
  function openDownloadModal() {
    document.getElementById('downloadModal').style.display = 'flex';
  }
  function closeDownloadModal() {
    document.getElementById('downloadModal').style.display = 'none';
  }
  
  // Close on outside click
  window.onclick = function(event) {
    const modal = document.getElementById('downloadModal');
    if (event.target == modal) {
      modal.style.display = "none";
    }
  }
</script>

</body>
</html>
